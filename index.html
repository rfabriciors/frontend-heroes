<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS API Customer</title>
    <style>
        body {
            background: rgb(80, 82, 83);
            font: normal 20px Lucida;
            color: cornsilk;
            width: 800px;
            margin: 0 auto;
        }
        div#entrada, div#div_result {
            margin-bottom: 20px;
            font-family: 'Faster One', cursive;
        }
        section p {
             margin: 5px 0;
        }
        header p {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
        }
        h1 {
            font-size: 4rem;
            text-align: center;
            }
    </style>
</head>
<body>
    <h1>Lendo API Response</h1>
    <div id="div_entrada" name="div_entrada">
        <input type="text" id="api_url" name="api_url">
        <input type="text" id="api_key" name="api_key">
        <input type="button" id="btn_consult" name="btn_consult" value="Consultar">
    </div>
    <div id="div_result" name="div_result"></div>
    <div id="div_result2" name="div_result2"></div>

    <section>
    </section>

    <script>
        var url_api = document.querySelector('input#api_url');
        var key_api = document.querySelector('input#api_key');
        var btn_result = document.querySelector('input#btn_consult');
        var resultado = document.querySelector('div#div_result');
        var resultado2 = document.querySelector('div#div_result2');
        var section = document.querySelector('section');

        // var flask_api_host = 'flaskapihost';
        var flask_api_host = 'flask-service';
        var flask_url =  'http://' + flask_api_host + ':5000/api';

        btn_result.addEventListener('click',getResult);
        /*
            var requestURL = 'https://mdn.github.io/learning-area/javascript/oojs/json/superheroes.json';
            var request = new XMLHttpRequest();
            request.open('GET', requestURL);
            request.responseType = 'json';
            request.send();
        */
        var request = new XMLHttpRequest();

        function getResult() {  // Faz a requisição a API
            // request.open('GET', 'https://mdn.github.io/learning-area/javascript/oojs/json/superheroes.json');
            request.open('GET', flask_url);
            console.log(flask_url);
            request.responseType = 'json';
            request.send();
        }

        request.onload = function () {
            // Do something with the retrieved data ( found in xmlhttp.response )
            var respostaJSON = request.response;
            populateHeader(respostaJSON);  // Preenche cabeçalho
            populateHerois(respostaJSON);  // Preenche a relação de heróis
        };   
        
        function populateHeader(JsonObj){
        
            var headerH1 = document.createElement('h1');
            headerH1.textContent = JsonObj['squadName'];
            resultado.appendChild(headerH1);

            var myPara = document.createElement('p');
            myPara.textContent = 'HomeTown: ' + JsonObj['homeTown'] +' // Formed: ' + JsonObj['formed'];

            console.log(JsonObj['homeTown']);
            resultado2.appendChild(myPara);
        }

        function populateHerois(JsonObj){
            var heroes = JsonObj['members'];
            for(var i=0;i<heroes.length;i++){
                console.log(`Nome: ${heroes[i].name}, Idade: ${heroes[i].age}, Identidade Secreta: ${heroes[i].secretIdentity}`);
                var myArticle = document.createElement('article');
                var myH2 = document.createElement('h2');
                var myPara1 = document.createElement('p');
                var myPara2 = document.createElement('p');
                var myPara3 = document.createElement('p');
                var myList = document.createElement('ul');

                myH2.textContent = heroes[i].name;
                myPara1.textContent = 'Secret identity: ' + heroes[i].secretIdentity;
                myPara2.textContent = 'Age: ' + heroes[i].age;
                myPara3.textContent = 'Superpowers:';

                myArticle.appendChild(myH2);
                myArticle.appendChild(myPara1);
                myArticle.appendChild(myPara2);
                myArticle.appendChild(myPara3);
                myArticle.appendChild(myList);

                section.appendChild(myArticle);
                
                var power = heroes[i]['powers'];
                for(var j=0;j<power.length;j++){
                    console.log(`\t${power[j]}`);
                    var listItem = document.createElement('li');
                    listItem.textContent = power[j];
                    myList.appendChild(listItem);
                }
            }
        }
    </script>
</body>
</html>